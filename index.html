<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shipping Instructions Fields Explorer</title>
  <style>
    :root {
      color-scheme: light;
      --bg: #f5f7fb;
      --card: #ffffff;
      --text: #1f2933;
      --muted: #52616b;
      --accent: #2563eb;
      --border: #e0e7ff;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 24px;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      margin-bottom: 20px;
    }

    h1 {
      font-size: 28px;
      margin: 0 0 8px;
    }

    p.lead {
      margin: 0;
      color: var(--muted);
    }

    .search-bar {
      margin: 18px 0 12px;
      position: relative;
    }

    .search-bar input {
      width: 100%;
      padding: 12px 14px 12px 40px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--card);
      box-shadow: var(--shadow);
      outline: none;
      transition: border-color 0.2s ease;
    }

    .search-bar input:focus {
      border-color: var(--accent);
    }

    .search-bar .icon {
      position: absolute;
      top: 50%;
      left: 12px;
      width: 18px;
      height: 18px;
      stroke: var(--muted);
      transform: translateY(-50%);
      pointer-events: none;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    thead {
      background: #eef2ff;
      color: #1f2a44;
    }

    th, td {
      padding: 12px 14px;
      text-align: left;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      font-size: 14px;
    }

    th {
      font-weight: 700;
    }

    tbody tr:hover {
      background: #f8fafc;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #e5edff;
      color: #1e40af;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 12px;
    }

    .nowrap { white-space: nowrap; }

    .enum-list {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .enum-item {
      background: #eef2ff;
      color: #1e3a8a;
      padding: 2px 8px;
      border-radius: 8px;
      font-size: 12px;
      line-height: 1.4;
    }

    @media (max-width: 960px) {
      th:nth-child(4), td:nth-child(4),
      th:nth-child(5), td:nth-child(5),
      th:nth-child(6), td:nth-child(6) {
        min-width: 220px;
      }
      table { display: block; overflow-x: auto; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Shipping Instructions 可查詢欄位</h1>
      <p class="lead">依照 parsed_fields.json 產生的欄位清單，可即時模糊搜尋欄位名稱、型別、描述或欄位結構。</p>
    </header>

    <div class="search-bar">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
      <input id="search" type="search" placeholder="搜尋 model / field / type / description..." autocomplete="off" />
    </div>
    <div class="status"><span id="match-count">載入中...</span><span class="muted">支援即時模糊搜尋</span></div>

    <table aria-label="Shipping instruction fields">
      <thead>
        <tr>
          <th>Model</th>
          <th>Field</th>
          <th>Type</th>
          <th>Description</th>
          <th>中文描述</th>
          <th>Required</th>
          <th>Example</th>
          <th>Enum</th>
        </tr>
      </thead>
      <tbody id="results"></tbody>
    </table>
  </div>

  <script>
    const searchInput = document.getElementById('search');
    const resultsBody = document.getElementById('results');
    const matchCount = document.getElementById('match-count');
    let fieldData = [];

    const translator = (() => {
      const replacements = [
        { pattern: /shipping instructions/gi, replace: '提單指示' },
        { pattern: /transport document/gi, replace: '運輸文件' },
        { pattern: /bill of lading/gi, replace: '提單' },
        { pattern: /sea waybill/gi, replace: '海運提單' },
        { pattern: /identifier/gi, replace: '識別碼' },
        { pattern: /reference/gi, replace: '參考號' },
        { pattern: /code/gi, replace: '代碼' },
        { pattern: /description/gi, replace: '描述' },
        { pattern: /required/gi, replace: '必填' },
        { pattern: /optional/gi, replace: '選填' },
        { pattern: /indicates?/gi, replace: '表示' },
        { pattern: /provides?/gi, replace: '提供' },
        { pattern: /provided/gi, replace: '提供的' },
        { pattern: /string/gi, replace: '字串' },
        { pattern: /number/gi, replace: '數值' },
        { pattern: /integer/gi, replace: '整數' },
        { pattern: /boolean/gi, replace: '布林' },
        { pattern: /list/gi, replace: '列表' },
        { pattern: /array/gi, replace: '陣列' },
        { pattern: /object/gi, replace: '物件' },
        { pattern: /carrier/gi, replace: '承運人' },
        { pattern: /vessel/gi, replace: '船舶' },
        { pattern: /voyage/gi, replace: '航次' },
        { pattern: /party/gi, replace: '參與者' },
        { pattern: /location/gi, replace: '地點' },
        { pattern: /country/gi, replace: '國家' },
        { pattern: /city/gi, replace: '城市' },
        { pattern: /postal/gi, replace: '郵遞' },
        { pattern: /address/gi, replace: '地址' },
        { pattern: /email/gi, replace: '電子郵件' },
        { pattern: /phone/gi, replace: '電話' },
        { pattern: /contact/gi, replace: '聯絡人' },
        { pattern: /date/gi, replace: '日期' },
        { pattern: /time/gi, replace: '時間' },
        { pattern: /status/gi, replace: '狀態' },
        { pattern: /approval/gi, replace: '核准' },
      ];

      const fineGrain = (text) => {
        return text
          .split(/(\\n|\\r\\n)/)
          .map(segment => {
            return segment.split(/(\b)/).map(part => {
              const rule = replacements.find(r => {
                r.pattern.lastIndex = 0;
                return r.pattern.test(part);
              });
              if (rule) {
                rule.pattern.lastIndex = 0;
                return part.replace(rule.pattern, rule.replace);
              }
              return part;
            }).join('');
          })
          .join('');
      };

      return (text = '') => {
        const trimmed = text.trim();
        if (!trimmed) return '';
        const rough = fineGrain(trimmed);
        if (rough === trimmed) {
          return `${trimmed}（繁體中文翻譯建議：請依內容調整）`;
        }
        return rough;
      };
    })();

    const formatEnum = (values) => {
      if (!values || !Array.isArray(values) || values.length === 0) return '<span class="muted">-</span>';
      return `<span class="enum-list">${values.map(v => `<span class="enum-item" title="${escapeHtml(v)}">${escapeHtml(v)}</span>`).join('')}</span>`;
    };

    const escapeHtml = (str = '') => str
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');

    const renderRows = (rows) => {
      resultsBody.innerHTML = rows.map(item => {
        const zhDescription = translator(item.description || '');
        return `
          <tr>
            <td class="nowrap">${escapeHtml(item.model || '')}</td>
            <td class="nowrap">${escapeHtml(item.field || '')}</td>
            <td class="nowrap">${escapeHtml(item.type || '')}</td>
            <td>${escapeHtml(item.description || '')}</td>
            <td>${escapeHtml(zhDescription)}</td>
            <td class="nowrap">${item.required ? '<span class="badge">必填</span>' : '<span class="muted">選填</span>'}</td>
            <td>${item.example ? `<code>${escapeHtml(item.example)}</code>` : '<span class="muted">-</span>'}</td>
            <td>${formatEnum(item.enum)}</td>
          </tr>
        `;
      }).join('');
      matchCount.textContent = `${rows.length} 筆符合結果`;
    };

    const filterRows = (term) => {
      if (!term) return fieldData;
      const keyword = term.toLowerCase();
      return fieldData.filter(item => {
        const haystacks = [item.field, item.type, item.description, item.model];
        return haystacks.some(value => (value || '').toLowerCase().includes(keyword));
      });
    };

    const initialize = async () => {
      try {
        const response = await fetch('parsed_fields.json');
        const data = await response.json();
        fieldData = data;
        renderRows(fieldData);
      } catch (error) {
        resultsBody.innerHTML = `<tr><td colspan="8">無法載入資料：${escapeHtml(error.message)}</td></tr>`;
        matchCount.textContent = '載入失敗';
      }
    };

    searchInput.addEventListener('input', (event) => {
      const filtered = filterRows(event.target.value.trim());
      renderRows(filtered);
    });

    initialize();
  </script>
</body>
</html>
